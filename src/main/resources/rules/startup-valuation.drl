/*
 * Copyright 2015 Red Hat, Inc. and/or its affiliates.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
*/


import cz.utb.fai.dto.StartupValuationRes
import cz.utb.fai.dto.type.Evidence
import cz.utb.fai.dto.type.Fact
import cz.utb.fai.dto.type.Hypothesis
import java.util.ArrayList
import java.util.List
import java.util.Arrays
import java.util.Collections
import cz.utb.fai.drools.TrackingAgendaEventListener
import cz.utb.fai.dto.type.Skills
import cz.utb.fai.dto.type.Conclusion

global StartupValuationRes response
global TrackingAgendaEventListener listener


rule "Business Needs - No"
salience 100
when
    Evidence(description == "Do you know what your business needs?", value == "no")
then
    Hypothesis hypothesis = new Hypothesis("Your business needs further analysis");
    insertLogical(hypothesis);
    response.appendExplanation(hypothesis.getDescription());
end

rule "Product Readiness Level"
salience 95
when
    Evidence(description == "What is your Product Readiness Level?", value == $value : value) and
    exists Hypothesis(description == "Your business needs further analysis")
then
    double rate = listener.adjustProductScore($value);
    Conclusion conclusion = new Conclusion("You current success probability is " + rate + " out of 100.", rate);

    response.setRate(conclusion.getRate());
    response.appendExplanation(conclusion.getDescription());
end

rule "Business Needs - Yes"
salience 99
when
    Evidence(description == "Do you know what your business needs?", value == "yes")
then
    insertLogical(new Hypothesis("Considering Frame Team."));
end

rule "Marketing skill"
salience 94
when
    exists Hypothesis(description == "Considering Frame Team.") and Evidence(description == "Do you have the marketing skills?", value == $ms : value )
then
    double rate = $ms.equals("yes") ? Skills.MARKETING_SKILLS : Skills.NO_SKILL;
    if (rate == Skills.NO_SKILL) {
        Hypothesis hypothesis = new Hypothesis("You should consider expanding your Marketing skills.");
        response.appendExplanation(hypothesis.getDescription());
    }
    response.appendRate(rate);
end

rule "Technical skill"
salience 93
when
    exists Hypothesis(description == "Considering Frame Team.") and Evidence(description == "Do you have the technical skills?", value == $ts : value )
then
    double rate = $ts.equals("yes") ? Skills.TECHNICAL_SKILLS : Skills.NO_SKILL;
    if (rate == Skills.NO_SKILL) {
        Hypothesis hypothesis = new Hypothesis("You should consider expanding your Technical skills.");
        response.appendExplanation(hypothesis.getDescription());
    }
    response.appendRate(rate);
end

rule "Analytical skill"
salience 92
when
    exists Hypothesis(description == "Considering Frame Team.") and Evidence(description == "Do you have the analytical skills?", value == $as : value )
then
    double rate = $as.equals("yes") ? Skills.ANALYTICAL_SKILLS : Skills.NO_SKILL;
    if (rate == Skills.NO_SKILL) {
        Hypothesis hypothesis = new Hypothesis("You should consider expanding your Analytical skills.");
        response.appendExplanation(hypothesis.getDescription());
    }
    response.appendRate(rate);
end

rule "Experience"
salience 91
when
    exists Hypothesis(description == "Considering Frame Team.") and Evidence(description == "Do you have previous experience as a team?", value == $experience : value )
then
    double rate = $experience.equals("yes") ? Skills.TEAM_SKILLS : Skills.NO_SKILL;
    if (rate == Skills.NO_SKILL) {
        Hypothesis hypothesis = new Hypothesis("You should consider experience in the field a bit more.");
        response.appendExplanation(hypothesis.getDescription());
    }
    response.appendRate(rate);
end

rule "Goal"
salience 90
when
    exists Hypothesis(description == "Considering Frame Team.") and Evidence(description == "Are your personal goals aligned with the start-up vision?", value == $goal : value )
then
    double rate = $goal.equals("yes") ? Skills.TEAM_SKILLS : Skills.NO_SKILL;
    if (rate == Skills.NO_SKILL) {
        Hypothesis hypothesis = new Hypothesis("You should revise if your goals are aligned with company visions.");
        response.appendExplanation(hypothesis.getDescription());
    }
    response.appendRate(rate);
end

rule "Expertise"
salience 89
when
    exists Hypothesis(description == "Considering Frame Team.") and Evidence(description == "Do your team or advisors have industry expertise?", value == $expertise : value )
then
    double rate = $expertise.equals("yes") ? Skills.TEAM_SKILLS : Skills.NO_SKILL;
    if (rate == Skills.NO_SKILL) {
        Hypothesis hypothesis = new Hypothesis("You should consider expertise in the field a bit more.");
        response.appendExplanation(hypothesis.getDescription());
    }
    response.appendRate(rate);
end

//TODO conclusion from FRAME TEAM?
